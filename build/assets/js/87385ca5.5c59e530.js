"use strict";(globalThis.webpackChunkai_humanoid_book=globalThis.webpackChunkai_humanoid_book||[]).push([[443],{6386(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"ros2-nervous-system/python-agents","title":"ROS 2 Communication with Python Agents","description":"This chapter explains how to bridge Python-based AI agents to robot controllers using client libraries, focusing on practical examples of AI-to-robot communication patterns.","source":"@site/docs/ros2-nervous-system/python-agents.md","sourceDirName":"ros2-nervous-system","slug":"/ros2-nervous-system/python-agents","permalink":"/docs/ros2-nervous-system/python-agents","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/ros2-nervous-system/python-agents.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_label":"ROS 2 Communication with Python Agents","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"ROS 2 Fundamentals","permalink":"/docs/ros2-nervous-system/ros2-fundamentals"},"next":{"title":"Humanoid Modeling with URDF","permalink":"/docs/ros2-nervous-system/urdf-modeling"}}');var o=t(4848),i=t(8453);const r={sidebar_label:"ROS 2 Communication with Python Agents",sidebar_position:3},a="ROS 2 Communication with Python Agents",l={},c=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Introduction to Client Libraries for ROS 2 Integration",id:"introduction-to-client-libraries-for-ros-2-integration",level:2},{value:"Bridging Python-based AI Agents to Robot Controllers",id:"bridging-python-based-ai-agents-to-robot-controllers",level:2},{value:"1. Setting up the Python Environment",id:"1-setting-up-the-python-environment",level:3},{value:"2. Creating a ROS 2 Node for the AI Agent",id:"2-creating-a-ros-2-node-for-the-ai-agent",level:3},{value:"3. Integrating with AI Frameworks",id:"3-integrating-with-ai-frameworks",level:3},{value:"Practical Examples of AI-to-Robot Communication Patterns",id:"practical-examples-of-ai-to-robot-communication-patterns",level:2},{value:"Publisher-Subscriber Pattern for Sensor Data",id:"publisher-subscriber-pattern-for-sensor-data",level:3},{value:"Service Client Pattern for High-Level Commands",id:"service-client-pattern-for-high-level-commands",level:3},{value:"Action Client Pattern for Long-Running Tasks",id:"action-client-pattern-for-long-running-tasks",level:3},{value:"Step-by-Step Tutorial for Basic AI-to-Robot Connection",id:"step-by-step-tutorial-for-basic-ai-to-robot-connection",level:2},{value:"Step 1: Install Dependencies",id:"step-1-install-dependencies",level:3},{value:"Step 2: Create the AI Agent Node",id:"step-2-create-the-ai-agent-node",level:3},{value:"Step 3: Launch the AI Agent",id:"step-3-launch-the-ai-agent",level:3},{value:"Best Practices for AI-Robot Communication",id:"best-practices-for-ai-robot-communication",level:2},{value:"1. Asynchronous Processing",id:"1-asynchronous-processing",level:3},{value:"2. Data Preprocessing",id:"2-data-preprocessing",level:3},{value:"3. Error Handling",id:"3-error-handling",level:3},{value:"Troubleshooting Common Connection Issues",id:"troubleshooting-common-connection-issues",level:2},{value:"Topic Connection Issues",id:"topic-connection-issues",level:3},{value:"Performance Issues",id:"performance-issues",level:3},{value:"Network Configuration",id:"network-configuration",level:3},{value:"Hands-on Exercise",id:"hands-on-exercise",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"ros-2-communication-with-python-agents",children:"ROS 2 Communication with Python Agents"})}),"\n",(0,o.jsx)(n.p,{children:"This chapter explains how to bridge Python-based AI agents to robot controllers using client libraries, focusing on practical examples of AI-to-robot communication patterns."}),"\n",(0,o.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,o.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Identify and use appropriate client libraries for ROS 2 integration with Python"}),"\n",(0,o.jsx)(n.li,{children:"Implement Python-based AI agents that connect to robot controllers"}),"\n",(0,o.jsx)(n.li,{children:"Apply different communication patterns (topics, services, actions) for AI-robot interaction"}),"\n",(0,o.jsx)(n.li,{children:"Create practical examples of AI-to-robot communication"}),"\n",(0,o.jsx)(n.li,{children:"Follow best practices for AI-robot communication in ROS 2"}),"\n",(0,o.jsx)(n.li,{children:"Troubleshoot common connection issues between AI agents and robots"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"introduction-to-client-libraries-for-ros-2-integration",children:"Introduction to Client Libraries for ROS 2 Integration"}),"\n",(0,o.jsx)(n.p,{children:"ROS 2 provides client libraries that enable programs written in various languages to interact with the ROS 2 ecosystem. The most commonly used libraries include:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"rclpy"}),": Python client library for ROS 2"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"rclcpp"}),": C++ client library for ROS 2"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"rclnodejs"}),": Node.js client library for ROS 2"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"rclc"}),": C client library for microcontrollers"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["For Python-based AI agents, ",(0,o.jsx)(n.strong,{children:"rclpy"})," is the primary choice as it provides a Pythonic interface to ROS 2 concepts and integrates well with the Python data science ecosystem."]}),"\n",(0,o.jsx)(n.h2,{id:"bridging-python-based-ai-agents-to-robot-controllers",children:"Bridging Python-based AI Agents to Robot Controllers"}),"\n",(0,o.jsx)(n.p,{children:"Connecting AI agents written in Python to robot controllers involves several key steps:"}),"\n",(0,o.jsx)(n.h3,{id:"1-setting-up-the-python-environment",children:"1. Setting up the Python Environment"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\nfrom sensor_msgs.msg import JointState\nfrom geometry_msgs.msg import Twist\n"})}),"\n",(0,o.jsx)(n.h3,{id:"2-creating-a-ros-2-node-for-the-ai-agent",children:"2. Creating a ROS 2 Node for the AI Agent"}),"\n",(0,o.jsx)(n.p,{children:"The AI agent runs as a ROS 2 node that can subscribe to sensor data and publish commands:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"class AIAgentNode(Node):\n    def __init__(self):\n        super().__init__('ai_agent_node')\n        self.subscription = self.create_subscription(\n            JointState,\n            'robot/joint_states',\n            self.listener_callback,\n            10)\n        self.publisher = self.create_publisher(Twist, 'cmd_vel', 10)\n\n    def listener_callback(self, msg):\n        # Process sensor data and generate AI decision\n        ai_decision = self.process_sensor_data(msg)\n        self.publisher.publish(ai_decision)\n\n    def process_sensor_data(self, sensor_data):\n        # AI logic implementation\n        pass\n"})}),"\n",(0,o.jsx)(n.h3,{id:"3-integrating-with-ai-frameworks",children:"3. Integrating with AI Frameworks"}),"\n",(0,o.jsx)(n.p,{children:"Python-based AI agents can leverage popular frameworks like TensorFlow, PyTorch, or scikit-learn:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import tensorflow as tf\nimport numpy as np\n\nclass MLAgentNode(Node):\n    def __init__(self):\n        super().__init__('ml_agent_node')\n        # Load pre-trained model\n        self.model = tf.keras.models.load_model('robot_control_model.h5')\n\n    def process_sensor_data(self, sensor_data):\n        # Preprocess sensor data for the model\n        processed_data = self.preprocess(sensor_data)\n        # Get prediction from model\n        prediction = self.model.predict(processed_data)\n        # Convert to ROS message\n        return self.convert_to_ros_msg(prediction)\n"})}),"\n",(0,o.jsx)(n.h2,{id:"practical-examples-of-ai-to-robot-communication-patterns",children:"Practical Examples of AI-to-Robot Communication Patterns"}),"\n",(0,o.jsx)(n.h3,{id:"publisher-subscriber-pattern-for-sensor-data",children:"Publisher-Subscriber Pattern for Sensor Data"}),"\n",(0,o.jsx)(n.p,{children:"AI agents typically subscribe to sensor topics to receive information about the robot's state and environment:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"# Subscribing to sensor data\nself.laser_subscription = self.create_subscription(\n    LaserScan,\n    'scan',\n    self.laser_callback,\n    10)\n\ndef laser_callback(self, msg):\n    # Process laser scan data for AI decision making\n    obstacles = self.detect_obstacles(msg)\n    self.make_navigation_decision(obstacles)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"service-client-pattern-for-high-level-commands",children:"Service Client Pattern for High-Level Commands"}),"\n",(0,o.jsx)(n.p,{children:"For request-response interactions, AI agents can use services:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from my_robot_msgs.srv import NavigationGoal\n\ndef send_navigation_goal(self, x, y, theta):\n    # Create a service client\n    self.nav_client = self.create_client(NavigationGoal, 'navigation_goal')\n\n    # Wait for service to be available\n    while not self.nav_client.wait_for_service(timeout_sec=1.0):\n        self.get_logger().info('Service not available, waiting again...')\n\n    # Create and send request\n    request = NavigationGoal.Request()\n    request.target_pose.x = x\n    request.target_pose.y = y\n    request.target_pose.theta = theta\n\n    # Call the service asynchronously\n    future = self.nav_client.call_async(request)\n    return future\n"})}),"\n",(0,o.jsx)(n.h3,{id:"action-client-pattern-for-long-running-tasks",children:"Action Client Pattern for Long-Running Tasks"}),"\n",(0,o.jsx)(n.p,{children:"For complex tasks with feedback and status, actions are more appropriate:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from rclpy.action import ActionClient\nfrom robot_behavior_msgs.action import ExecuteBehavior\n\nclass AIPlannerNode(Node):\n    def __init__(self):\n        super().__init__('ai_planner_node')\n        self._action_client = ActionClient(\n            self,\n            ExecuteBehavior,\n            'execute_behavior'\n        )\n\n    def execute_behavior(self, behavior_name):\n        goal_msg = ExecuteBehavior.Goal()\n        goal_msg.behavior_name = behavior_name\n\n        self._action_client.wait_for_server()\n        return self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback\n        )\n\n    def feedback_callback(self, feedback_msg):\n        # Handle feedback from the behavior execution\n        self.get_logger().info(f'Feedback: {feedback_msg.feedback.progress}')\n"})}),"\n",(0,o.jsx)(n.h2,{id:"step-by-step-tutorial-for-basic-ai-to-robot-connection",children:"Step-by-Step Tutorial for Basic AI-to-Robot Connection"}),"\n",(0,o.jsx)(n.h3,{id:"step-1-install-dependencies",children:"Step 1: Install Dependencies"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pip install rclpy\n# For AI frameworks\npip install tensorflow pytorch scikit-learn\n"})}),"\n",(0,o.jsx)(n.h3,{id:"step-2-create-the-ai-agent-node",children:"Step 2: Create the AI Agent Node"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import LaserScan\nfrom geometry_msgs.msg import Twist\n\nclass SimpleAIAgent(Node):\n    def __init__(self):\n        super().__init__('simple_ai_agent')\n        self.publisher = self.create_publisher(Twist, 'cmd_vel', 10)\n        self.subscription = self.create_subscription(\n            LaserScan,\n            'scan',\n            self.scan_callback,\n            10)\n        self.timer = self.create_timer(0.1, self.timer_callback)\n\n    def scan_callback(self, msg):\n        # Store latest scan data\n        self.latest_scan = msg\n\n    def timer_callback(self):\n        if hasattr(self, 'latest_scan'):\n            cmd_vel = self.simple_navigation_logic(self.latest_scan)\n            self.publisher.publish(cmd_vel)\n\n    def simple_navigation_logic(self, scan):\n        cmd = Twist()\n        # Simple obstacle avoidance\n        min_distance = min(scan.ranges)\n        if min_distance > 1.0:\n            cmd.linear.x = 0.5  # Move forward\n            cmd.angular.z = 0.0\n        else:\n            cmd.linear.x = 0.0  # Stop\n            cmd.angular.z = 0.5  # Turn\n        return cmd\n\ndef main(args=None):\n    rclpy.init(args=args)\n    ai_agent = SimpleAIAgent()\n\n    try:\n        rclpy.spin(ai_agent)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        ai_agent.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,o.jsx)(n.h3,{id:"step-3-launch-the-ai-agent",children:"Step 3: Launch the AI Agent"}),"\n",(0,o.jsx)(n.p,{children:"Create a launch file to run the AI agent:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from launch import LaunchDescription\nfrom launch_ros.actions import Node\n\ndef generate_launch_description():\n    return LaunchDescription([\n        Node(\n            package='ai_agent',\n            executable='simple_ai_agent',\n            name='simple_ai_agent',\n            output='screen'\n        )\n    ])\n"})}),"\n",(0,o.jsx)(n.h2,{id:"best-practices-for-ai-robot-communication",children:"Best Practices for AI-Robot Communication"}),"\n",(0,o.jsx)(n.h3,{id:"1-asynchronous-processing",children:"1. Asynchronous Processing"}),"\n",(0,o.jsx)(n.p,{children:"Handle ROS 2 callbacks asynchronously to avoid blocking the AI computation:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import asyncio\n\nclass AsyncAIAgent(Node):\n    def __init__(self):\n        super().__init__('async_ai_agent')\n        self.ai_loop = asyncio.new_event_loop()\n\n    def sensor_callback(self, msg):\n        # Offload AI processing to a separate thread\n        self.ai_loop.run_in_executor(None, self.process_with_ai, msg)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"2-data-preprocessing",children:"2. Data Preprocessing"}),"\n",(0,o.jsx)(n.p,{children:"Ensure sensor data is properly preprocessed before feeding it to AI models:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"def preprocess_sensor_data(self, raw_data):\n    # Normalize data\n    normalized = (raw_data - self.mean) / self.std\n    # Reshape for model input\n    reshaped = normalized.reshape(1, -1)\n    return reshaped\n"})}),"\n",(0,o.jsx)(n.h3,{id:"3-error-handling",children:"3. Error Handling"}),"\n",(0,o.jsx)(n.p,{children:"Implement robust error handling for both ROS 2 communication and AI inference:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"def safe_ai_inference(self, sensor_data):\n    try:\n        # Validate input data\n        if not self.validate_input(sensor_data):\n            return self.fallback_behavior()\n\n        # Perform AI inference\n        result = self.ai_model.predict(sensor_data)\n        return self.convert_to_robot_command(result)\n\n    except Exception as e:\n        self.get_logger().error(f'AI inference error: {e}')\n        return self.safety_fallback()\n"})}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting-common-connection-issues",children:"Troubleshooting Common Connection Issues"}),"\n",(0,o.jsx)(n.h3,{id:"topic-connection-issues",children:"Topic Connection Issues"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Symptom"}),": No data received from topics"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Solution"}),": Check topic names with ",(0,o.jsx)(n.code,{children:"ros2 topic list"})," and verify correct namespace usage"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"performance-issues",children:"Performance Issues"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Symptom"}),": Slow response from AI agent"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Solution"}),": Profile the AI inference and optimize the model or use a more efficient implementation"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"network-configuration",children:"Network Configuration"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Symptom"}),": Nodes on different machines cannot communicate"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Solution"}),": Ensure proper DDS configuration and network settings (ROS_DOMAIN_ID, RMW implementation)"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"hands-on-exercise",children:"Hands-on Exercise"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Environment Setup"}),": Set up a Python environment with rclpy installed. If you don't have ROS 2 installed, create a virtual environment and install a mock library to simulate the experience."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Simple Node Creation"}),': Create a simple Python ROS 2 node that publishes a "hello world" message to a topic every second. Use the node creation pattern shown in this chapter.']}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"AI Integration Practice"}),': Modify the simple node to simulate an AI decision by randomly choosing between two commands (e.g., "move forward" or "turn left") and publishing the decision.']}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,o.jsxs)(n.p,{children:["This chapter covered the essential concepts for connecting Python-based AI agents to robot controllers using ROS 2. You learned about client libraries, communication patterns, practical implementation examples, and best practices. In the previous chapter, ",(0,o.jsx)(n.a,{href:"./ros2-fundamentals",children:"ROS 2 Fundamentals"}),", you learned about the core concepts of ROS 2 architecture. In the next chapter, ",(0,o.jsx)(n.a,{href:"./urdf-modeling",children:"Humanoid Modeling with URDF"}),", you'll explore robot structure definition using URDF."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>r,x:()=>a});var s=t(6540);const o={},i=s.createContext(o);function r(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);